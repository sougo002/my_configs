---
name: reviewing-code
description: developmentブランチとの差分をレビューし、品質・セキュリティ・保守性を評価します。PRやコード変更のレビュー時に使用。
allowed-tools: Read, Grep, Glob, Bash, Task
---

# コードレビュースキル

**出力は常に日本語で行う。**

## ベースブランチ

デフォルトは `development`。ユーザーが指定した場合はそちらを優先する（gitStatusの "Main branch for PRs" は使わない）。

三点ドットで分岐点からの差分のみを対象とする:

```bash
git diff <base>...HEAD
```

## ワークフロー

### Step 1: 差分取得（メインエージェント）

```bash
git diff --name-status <base>...HEAD   # 変更ファイル一覧（A/M/D）
git diff <base>...HEAD                 # diff（ファイル単位で構造化されている）
```

### Step 2: 並列レビュー（サブエージェント）

以下の4つのサブエージェント（Task ツール, subagent_type=general-purpose, model=sonnet）を起動する。
**重要: 4つの Task ツール呼び出しを必ず1つのレスポンス内でまとめて行うこと。これにより並列実行される。**
各サブエージェントには変更ファイル一覧・diff・参照ガイドのパスを渡す。
サブエージェントは必要に応じて Read で完全なソースコードや周辺コードを確認する。

| サブエージェント | 観点 | 参照ガイド |
|-----------------|------|-----------|
| アーキテクチャ | 設計原則、依存関係、コードスメル | [ARCHITECTURE.md](ARCHITECTURE.md) |
| セキュリティ | 脆弱性、認証、入力検証 | [SECURITY.md](SECURITY.md) |
| コード品質 | 可読性、構造、エラーハンドリング | [CHECKLIST.md](CHECKLIST.md) |
| テスト | カバレッジ、テスト品質 | [CHECKLIST.md](CHECKLIST.md) |

各サブエージェントへの指示テンプレート:

```
以下の変更をレビューしてください。出力は日本語で行うこと。

## 観点
[アーキテクチャ / セキュリティ / コード品質 / テスト]

## 参照ガイド
[対応するガイドファイルを読み込んで基準として使用すること]

## 変更ファイル一覧
[git diff --name-status の出力]

## diff
[git diff <base>...HEAD の出力]

## 指示
必要に応じて Read で完全なソースコードや周辺コードを確認すること。

## 出力形式
重大度（Critical/High/Medium/Low）と共に所見を箇条書きで報告すること。
良い実装があれば併せて報告すること。
```

### Step 3: 統合（メインエージェント）

サブエージェントの結果を統合し、出力形式に従ってレビュー結果を生成する。

## レビュー優先度

| 優先度 | 基準 | 例 |
|--------|------|-----|
| Critical | マージ前に必ず修正 | セキュリティ脆弱性、データ消失リスク、破壊的変更 |
| High | 修正すべき | 設計原則違反、エラーハンドリング欠如、パフォーマンスボトルネック |
| Medium | 修正を検討 | スタイル不統一、テスト不足、技術的負債 |
| Low | 提案 | 命名改善、ドキュメント不足、軽微なリファクタリング |

## 出力形式

レビュー結果は `./a/self-review/pr-review-<ブランチ名>.md` に保存:

```markdown
## サマリー
- 変更ファイル数: X
- 行数: +XXX / -XXX
- スコープ: [frontend/backend/database/config]

## 評価
- グレード: [S/A+/A/B+/B/C+/C/D]
- マージ推奨: [Ready/軽微な修正が必要/修正が必要/要再作業]

## 所見

### 良い実装
- [具体例]

### Critical Issues
- [セキュリティリスク、バグ]

### Warnings
- [設計上の問題、パフォーマンス]

### Suggestions
- [将来的な改善提案]

## 推奨アクション
1. 即時対応: [重大な修正]
2. 短期: [重要な改善]
3. 長期: [技術的負債]
```

## 注意事項

- レビューはPR作成前に実行する（作成後ではなく）
- 変更のコンテキストと意図を考慮する
- 建設的で実行可能なフィードバックを提供する
- 所見は重大度順に優先度付けする